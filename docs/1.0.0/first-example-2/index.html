<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>First Example (part 2) · uStart</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Let&#x27;s continue with the `Dog` example by adding a [Datasource](/docs/1.0.0/datasources). We are going to replace the array were we stored the dogs for a table in **PostgreSQL**."/><meta name="docsearch:version" content="1.0.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="First Example (part 2) · uStart"/><meta property="og:type" content="website"/><meta property="og:url" content="https://ustart-dev.github.io/"/><meta property="og:description" content="Let&#x27;s continue with the `Dog` example by adding a [Datasource](/docs/1.0.0/datasources). We are going to replace the array were we stored the dogs for a table in **PostgreSQL**."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-129019450-2', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/icono-ustart.svg" alt="uStart"/><h2 class="headerTitleWithLogo">uStart</h2></a><a href="/versions"><h3>1.0.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/1.0.0/installation" target="_self">Docs</a></li><li class=""><a href="https://github.com/ustart-dev" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Getting Started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/1.0.0/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/first-example-1">First Example (part 1)</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/1.0.0/first-example-2">First Example (part 2)</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/project-structure">Project Structure</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/1.0.0/schema">Schema</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/resolvers">Resolvers</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/datasources">Datasources</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/models">Models</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/schema-directives">Schema Directives</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/mocking">Mocking</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/email">Email</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.0/build-deploy">Build &amp; Deploy</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/1.0.0/commands">CLI Commands</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">First Example (part 2)</h1></header><article><div><span><p>Let's continue with the <code>Dog</code> example by adding a <a href="/docs/1.0.0/datasources">Datasource</a>. We are going to replace the array were we stored the dogs for a table in <strong>PostgreSQL</strong>.</p>
<h2><a class="anchor" aria-hidden="true" id="requirements"></a><a href="#requirements" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Requirements</h2>
<p>Install PostgreSQL engine in your system, if you don't have already.
You also need to install the PostgreSQL node drivers.</p>
<p>Move to the root of your project and execute:</p>
<pre><code class="hljs css language-bash">npm install pg pg-hstore
</code></pre>
<p>uStart uses Sequelize 5 to connect with relational databases and it is installed by default when you executed <code>ustart init</code>.</p>
<p>Now go to PostgreSQL (using whatever you use to manage it) and create a database. The database name must end with <em>_test</em>. It is a name convention explained in <a href="/docs/1.0.0/datasources">Datasources</a> section. In this example we will use <strong>awesome-example_test</strong>.</p>
<h2><a class="anchor" aria-hidden="true" id="connect-to-postgresql"></a><a href="#connect-to-postgresql" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connect to PostgreSQL</h2>
<p>To connect to PostgreSQL, open the script <code>src/data/datasources.js</code> and paste:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> { ustart } <span class="hljs-keyword">from</span> <span class="hljs-string">"ustart"</span>;

ustart.connect(process.env.PG_URI);
</code></pre>
<p>uStart uses a <code>.env</code> file to configure the environment. It is located at the root of your project, open it and append the database info as follow:</p>
<pre><code class="hljs css language-bash">PG_URI=<span class="hljs-string">"postgres://user:pass@example.com:5432/dbname"</span>
</code></pre>
<p>Replace the attributes with your values.</p>
<p>For our example, which is running at localhost without user and password:</p>
<pre><code class="hljs css language-bash">PG_URI=<span class="hljs-string">"postgres://localhost:5432/awesome-example_test"</span>
</code></pre>
<p>To verify the connection start the server:</p>
<pre><code class="hljs css language-bash">npm start
</code></pre>
<p>Once it is ready you should see an output like this:</p>
<pre><code class="hljs css language-bash">...
Executing (default): SELECT 1+1 AS result
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="define-a-model"></a><a href="#define-a-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Define a Model</h2>
<p>We have to define a model that represents the <code>Dog</code> table. It will also provide us with write and read operations. uStart have the <code>defineModel</code> method to do this task and it accepts three arguments: <em>datasource</em>, <em>model name</em> and <em>options</em>. More details on <a href="/docs/1.0.0/models">Models</a> section.</p>
<p>All models are organized by entity and must have the suffix <code>.model.js</code> (a name convention), this way uStart will located it and load it automatically. Create the model <code>dog.model.js</code> at <code>Dog</code> entity:</p>
<pre><code class="hljs css language-bash">touch ./src/entities/Dog/dog.model.js
</code></pre>
<p>and paste:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> Sequelize <span class="hljs-keyword">from</span> <span class="hljs-string">"sequelize"</span>;
<span class="hljs-keyword">import</span> { ustart } <span class="hljs-keyword">from</span> <span class="hljs-string">"ustart"</span>;

ustart.defineModel(<span class="hljs-string">"postgres"</span>, <span class="hljs-string">"dog"</span>, {
  <span class="hljs-attr">id</span>: {
    <span class="hljs-attr">type</span>: Sequelize.INTEGER,
    <span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: Sequelize.STRING(<span class="hljs-number">10</span>) },
  <span class="hljs-attr">age</span>: { <span class="hljs-attr">type</span>: Sequelize.INTEGER }
}, {
  <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">false</span>
});
</code></pre>
<p>If you have followed the <a href="first-example-1">Part 1</a> of this example, you should remember that <strong>Dog</strong> has three attributes: <em>id</em>, <em>name</em> and <em>age</em>. Here, we are telling to the framework that our <em>Dog</em> entity will have those three attributes in the database too. Sequelize have the ability to sync your database schema to match your models, this option is enabled by default by uStart. Thus, if you have leaved the server running you will see that Sequelize has already synchronized your database, otherwise start it with <code>npm start</code>.</p>
<p>In both cases you will find an output like this:</p>
<pre><code class="hljs css language-bash">...
Executing (default): CREATE TABLE IF NOT EXISTS <span class="hljs-string">"dogs"</span> (<span class="hljs-string">"id"</span>  SERIAL , <span class="hljs-string">"name"</span> VARCHAR(10), <span class="hljs-string">"age"</span> INTEGER, PRIMARY KEY (<span class="hljs-string">"id"</span>));
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = <span class="hljs-string">'r'</span> and t.relname = <span class="hljs-string">'dogs'</span> GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
</code></pre>
<p><strong>Note</strong>: Sequelize applies pluralization to database names, transforming <code>dog</code> to <code>dogs</code> as table name. This will not affect your model's name.</p>
<p>All models are available at <code>ustart.models</code> attribute, so be aware that model names must be unique across your app.</p>
<h2><a class="anchor" aria-hidden="true" id="adjusting-the-resolver"></a><a href="#adjusting-the-resolver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adjusting the resolver</h2>
<p>To use our fancy new model, we just have to adjust the resolver to use it instead of the previous array. uStart adds an instance to the application context, all you have to do is to access to <code>ustart</code> in the context argument of a resolver (located in the third position).</p>
<p>The <em>getDog</em> query:</p>
<pre><code class="hljs css language-js">getDog: <span class="hljs-function">(<span class="hljs-params">root, args</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { id } = args;

  <span class="hljs-keyword">return</span> dogList.find(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e.id == id);
},
</code></pre>
<p>is transformed to:</p>
<pre><code class="hljs css language-js">getDog: <span class="hljs-function">(<span class="hljs-params">root, args, context</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { id } = args;
  <span class="hljs-keyword">const</span> { ustart } = context;

  <span class="hljs-keyword">return</span> ustart.models.dog.findByPk(id);
},
</code></pre>
<p>Go on and modify the entire resolver, or you can paste the code:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> dogResolvers = {
  <span class="hljs-attr">Query</span>: {
    <span class="hljs-attr">getDog</span>: <span class="hljs-function">(<span class="hljs-params">root, args, { ustart }</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> ustart.models.dog.findByPk(args.id);
    },
  },
  <span class="hljs-attr">Mutation</span>: {
    <span class="hljs-attr">newDog</span>: <span class="hljs-function">(<span class="hljs-params">root, args, { ustart }</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> ustart.models.dog.create({ <span class="hljs-attr">name</span>: args.name, <span class="hljs-attr">age</span>: args.age });
    },
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> dogResolvers;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="try-out"></a><a href="#try-out" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Try out</h2>
<p>We start by executing <code>getDog</code> query (paste it on the playground):</p>
<pre><code class="hljs css language-graphql">query {
  getDog(<span class="hljs-built_in">id</span>: <span class="hljs-number">1</span>) {
    <span class="hljs-built_in">name</span>,
    age
  }
}
</code></pre>
<p>Press <strong>PLAY</strong> and the result must be:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"getDog"</span>: <span class="hljs-literal">null</span>
  }
}
</code></pre>
<p>There is no dog yet, so we don't expect any data. Let's go and register a dog:</p>
<pre><code class="hljs css language-graphql">mutation {
  newDog (<span class="hljs-built_in">name</span>: <span class="hljs-string">"Vito"</span>, age: <span class="hljs-number">3</span>) {
    <span class="hljs-built_in">id</span>,
    <span class="hljs-built_in">name</span>,
    age
  }
}
</code></pre>
<p>It should return:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"newDog"</span>: {
      <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Vito"</span>,
      <span class="hljs-attr">"age"</span>: <span class="hljs-number">3</span>
    }
  }
}
</code></pre>
<p>If you look at your terminal you will see both SQL statements: <em>SELECT</em> and <em>INSERT</em>:</p>
<pre><code class="hljs css language-bash">Executing (default): SELECT <span class="hljs-string">"id"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span> FROM <span class="hljs-string">"dogs"</span> AS <span class="hljs-string">"dog"</span> WHERE <span class="hljs-string">"dog"</span>.<span class="hljs-string">"id"</span> = 1;
Executing (default): INSERT INTO <span class="hljs-string">"dogs"</span> (<span class="hljs-string">"id"</span>,<span class="hljs-string">"name"</span>,<span class="hljs-string">"age"</span>) VALUES (DEFAULT,<span class="hljs-variable">$1</span>,<span class="hljs-variable">$2</span>) RETURNING *;
</code></pre>
<p>We re-run <code>getDog</code> and it should return:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"getDog"</span>: {
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Vito"</span>,
      <span class="hljs-attr">"age"</span>: <span class="hljs-number">3</span>
    }
  }
}
</code></pre>
<p>If you did your homework and implemented the <code>getAllDogs</code> query, you can make it work now by using the <code>findAll()</code> method from the <code>dog</code> model.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-4-17 by Leonel Peña</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/1.0.0/first-example-1"><span class="arrow-prev">← </span><span>First Example (part 1)</span></a><a class="docs-next button" href="/docs/1.0.0/project-structure"><span>Project Structure</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#requirements">Requirements</a></li><li><a href="#connect-to-postgresql">Connect to PostgreSQL</a></li><li><a href="#define-a-model">Define a Model</a></li><li><a href="#adjusting-the-resolver">Adjusting the resolver</a></li><li><a href="#try-out">Try out</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/icono-ustart.svg" alt="uStart" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/installation.html">Getting Started</a><a href="/docs/schema.html">Guides</a><a href="/docs/commands.html">API Reference</a></div><div><h5>Community</h5><a href="https://twitter.com/_uStart" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://linkedin.com/company/ustart-dev" target="_blank" rel="noreferrer noopener">LinkedIn</a><a href="https://www.facebook.com/ustart.dev/" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://github.com/ustart-dev">GitHub</a><a class="github-button" href="https://github.com/ustart-dev/ustart" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 USTART SPA</section></footer></div></body></html>